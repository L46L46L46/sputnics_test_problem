# Тестовое задание
## Постановка задачи
Тестовое задание заключается в разработке программного обеспечения для моделирования системы стабилизации космического аппарата (КА) с использованием языка программирования С++ или Matlab и состоит из следующих частей:
  1. Реализовать решатель нормальной системы обыкновенных дифференциальных уравнений (ОДУ). На вход решатель должен принимать вектор-функцию правых частей.
  2. Записать в форме системы ОДУ динамику КА и его систему управления, которая на вход принимает кватернион целевой ориентации, а на выходе выдает изменение кинетического момента системы из трёх маховиков.
  3. Обосновать выбор параметров, коэффициентов и структуры системы управления, а также выбор настроек решателя.
  
  **NOTE** Разрешается использовать библиотеки линейной алгебры. Обоснования, пояснения, графики полученных результатов должны быть оформлены отдельным текстовым документом
## Параметры космического аппарата
Тензор инерции КА
  ```math
J =
\begin{pmatrix}
  3.0 & -0.1 & 0.0 \\
  -0.1 & 2.3 & 0.2 \\
  0.0 & 0.2 & 1.9
\end{pmatrix}
```
Максимальный кинетический момент маховика $H_{max} = 0.2 \text{ Н} \cdot \text{м} \cdot{с}$

Максимальный момент маховика $M_{max} = 0.005 \text{ Н} \cdot \text{м}$

Момент инерции ротора $J_p = 5 \cdot 10^{-4} \text{ кг} \cdot \text{м}^2$

Оси трёх маховиков расположены по осям связанной системы координат

**NOTE** Датчики КА измеряют угловую скорость и ориентацию в связанной системе координат. Измерения и управления считать идеальными.
## Полезные выражения
Динамические уравнения Эйлера
```math
  J \frac{d \omega}{dt} + \omega \times J \omega + \omega \times H = - \frac{dH}{dt} \text{, где } \frac{dH}{dt} \text{ -- управление}
```
Кинематические соотношения для кватерниона ориентации:
```math
  \begin{pmatrix}
    \dot q_o \\
    \dot q
  \end{pmatrix}
  =
  \begin{pmatrix}
    q \cdot \omega \\
    q_0 \omega + q \times \omega
  \end{pmatrix}
```
## Полезные источники
  1. Full quaternion based attitude PD-control for a quadrotor
  https://folk.ntnu.no/skoge/prost/proceedings/ecc-2013/data/papers/0927.pdf
  2. A study of angular motion of the Chibis-M microsatellite with three-axis flywheel control
  https://www.researchgate.net/publication/257832553_A_study_of_angular_motion_of_the_Chibis-M_microsatellite_with_three-axis_flywheel_control
## Решение тестового задания
В процессе решения написан код на Matlab, который приводит ориентацию аппарата в орбитальной системе координат к заданной постоянной системе координат.
### Обоснование выбора параметров
В качестве алгоритма управления было использовано управление с обратной связью. Выбор констант этого управления осуществлялся на основе работы 2 из списка литературы. Стабилизация проводилась в орбитальной системе координат. Это было сделано по двум причинам: поскольку, та же стаблизация была в работе Ткачева С.С., появляется возможность проверить правильность написания формул по результатам вычислений из статьи. Кроме того, код стабилизации в ОСК проще переписать для стабилизации в ИСК, чем наоборот.

В той же работе были заданы параметры орбиты: высота 550 км и наклонение $56.7^{\circ}$. Начальный кватернион ориентации и кватернион целевой ориентации выбираются случайным образом.
### Результат работы алгоритма
<img width="310" height="250" alt="image" src="https://github.com/user-attachments/assets/157eb578-a82f-45b4-8d8f-cf108960d36b" />
<img width="310" height="250" alt="image" src="https://github.com/user-attachments/assets/bb7329b9-a31f-473a-a5d3-eb93606bc0f2" />
На графиках представлено изменение угловой скорости и кватерниона ориентации аппарата относительно ОСК после начала работы алгортма. Кинетический момент изменяется как:
<img width="616" height="499" alt="image" src="https://github.com/user-attachments/assets/cfffdc68-3e62-4ecf-b58f-7fee923ccb67" />

### Описание используемых функций
- main.m
- RK4.m -- метод Рунге-Кутта 4 порядка с постоянным шагом
- RefOmegaQuat.m -- функция для получения угловой скорости и кватерниона ориентации Орбитальной сисетмы координат относительно Инерциальной системы координат
- Satellite.m -- класс с информацией о динамике изменений положения, скоростей, управляющего момента
- controlParams.m -- функция вычисляет постоянные управления аппаратом
- flywhellControl.m -- расчитывает требуемое на данном шаге управления (без накладываемых на него ограничений)
- getPlot.m -- унифицированное построение графиков
- integrator.m -- преобразование входных параметров, вызов RK4.m; на выходе получаем значения векторов скоростей и ориентации на следующем шаге
- ode.m - функция правых частей ОДУ

Технические функции, которые нужны, чтобы компенсировать отсутствие Aerospace Toolbox
- MNQuatMultiply.m
- mDcm2quat.m
- mQuat2dcm.m
- mQuatConj.m
